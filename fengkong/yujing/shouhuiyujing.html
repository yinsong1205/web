<!--工期预警  -->
<div class="container-fluid" id="shouhuiyujing">
	<div class="col-sm-12 plr0 height100 gridBox" id="shouhuiyujing_gridBox">
		<table id="shouhuiyujing_jqGrid"></table>
		<div id="shouhuiyujing_jqGridPager"></div>
	</div>
</div>


<!-- 新增弹窗 -->
<div id="shouhuiyujing_formBox" class="layerFormBox">
	<form class="form-horizontal layerForm col-xs-12">
		<h4 class="col-xs-12 text-center">报关单</h4>
		<div class="col-xs-12 index">
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					预录入编号:
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_number" name="number" class="form-control input-sm" value="000000000092371271">
				</div>
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					海关编号:
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					出口口岸
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_type" name="type" class="form-control input-sm" value="天津新港">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					备案号
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					出口日期
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_outTime" onclick="WdatePicker();" name="outTime" class="form-control input-sm" value="2014-10-19">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					申报日期
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_county" onclick="WdatePicker();" name="createTime" class="form-control input-sm" value="2015-01-29">
				</div>		
			</div>

			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					经营单位
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm" value="某集团工程有限公司">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					运输方式
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm" value="水路运输">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					运输工具
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm" value="轮船">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					提运单号
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>

			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					发货单位
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm" value="某集团工程有限公司">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					贸易方式
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_property" name="property" class="form-control input-sm" value="一般贸易">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					征免性质
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					提运单号
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>

			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					许可证号
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label" value="s2566764">
					运抵国
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_company" name="company" class="form-control input-sm" value="美国">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					指运港
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_anothertype" name="anothertype" class="form-control input-sm" value="波士顿">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					境内货源地
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>

			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					批准文号
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm" value="PZX63D832">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					成交方式
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_pay" name="pay" class="form-control input-sm" value="FOB">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					运费
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					保费
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					杂费
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>

			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					合同协议号
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm" value="4520000254">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					件数
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm" value="32">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					包装种类
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					毛重（kg）
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					净重（kg）
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>

			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					集装箱号
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					随附单据
				</label>
				<div class="col-xs-8">
					<input type="text" id="yulu_accessory" name="accessory" class="form-control input-sm">
				</div>		
			</div>
			<div class="form-group col-xs-4">
				<label class="col-xs-4 control-label">
					生产厂家
				</label>
				<div class="col-xs-8">
					<input type="text" class="form-control input-sm">
				</div>		
			</div>

			<div class="form-group col-xs-12">
				<label class="col-xs-2 control-label text-center">
					标记码及备注
				</label>
				<div class="col-xs-10">
					<textarea type="text" class="form-control input-sm"></textarea>.
				</div>		
			</div>
			<div id="yulu_ul col-xs-12">
				<table class="table col-xs-12">
					<thead class="thead">
						<tr>
							<th>项号</th>
							<th>商品编号</th>
							<th>商品名称 规格型号</th>
							<th>数量及单位</th>
							<th>最终目的国（地区）</th>
							<th>单价</th>
							<th>总价</th>
							<th>币值</th>
							<th>征免</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>1</td>
							<td>4019991010</td>
							<td>钻井防滑板|无品牌|无型号</td>
							<td>50  个</td>
							<td>美国</td>
							<td>193.36</td>
							<td>9668.08</td>
							<td>美元</td>
							<td></td>
						</tr>
						<tr>
							<td>2</td>
							<td>3544492100</td>
							<td>电缆|传输电力|无型号|400伏</td>
							<td>0.8  千米</td>
							<td>美国</td>
							<td>1012.42</td>
							<td>10731.69</td>
							<td>美元</td>
							<td></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		<p class="text-center col-xs-12">
			<button type="button" class="saveBtn btn btn-info btn-sm" id="yulu_save_btn">
				打印
			</button>
			<button type="button" class="saveBtn btn btn-info btn-sm qx">
				取消
			</button>
		</p>
	</form>
</div>
<script type="text/javascript">

	
$(function(){
	var dataUrl = 'data/shouhuiyujing.json';
	var index = null;
	var flag = '';
	var rowNumber = 1000000;

	//表格数据
	var gridWidth = $('#shouhuiyujing_gridBox').width();
	var gridHeight = $('#shouhuiyujing_gridBox').height()-118;
	$("#shouhuiyujing_jqGrid").jqGrid({
		url: dataUrl,
		hidegrid : false, 
		altRows : true, 
		colModel: [{label : '关单号', name : 'hetongnumber', align: 'center', width: 120,formatter: formatName},
			{label : '出口口岸', name : 'hetongname', align: 'center', width:120},
			{label : '贸易类型', name : 'time', align: 'center', width:120},
			{label : '运抵国', name : 'startTime', align: 'center', width:120},
			{label : '出口日期', name : 'endTime', align: 'center', width:120},
			{label : '收汇状态', name : 'dataTime', align: 'center', width:120},
			{label : '剩余天数', name : 'overTime', align: 'center', width:120}],
		viewrecords: true,
		loadonce:true,
		width: gridWidth,
		//width: 'auto',
		//width : '100%',
		height: gridHeight,
		//height : 'auto',
		rowNum: 11,
		rowList:[10,15,20,25],
		datatype: 'local',
		pager: "#shouhuiyujing_jqGridPager",
		rownumbers: true,
		multiselect: true,
		rownumWidth: 30,
		recordtext: "当前显示: <b>{0}</b>至<b>{1}</b> 总数: <b>{2}</b>",
	    //emptyrecords: "No records to view",
		//loadtext: "Loading...",
		
	}).navGrid("#shouhuiyujing_jqGridPager",{ // the buttons to appear on the toolbar of the grid
		edit:false,add:false,del:false,search:false,refresh:false
	}).navSeparatorAdd('#shouhuiyujing_jqGridPager',{
		sepcontent: '',
		sepclass : "ui-separator"
	});
	//搜索框按钮,开启搜索框需要重新调整高度
	$('#shouhuiyujing_jqGrid').jqGrid('filterToolbar');
	
	fetchGridData();
	
	//editGridRow新增记录；viewGridRow查看记录详情；delGridRow删除记录。
					//格式化标题
		function formatName(cellValue, options, rowObject) {
			var len = cellValue.length;
			if(len>50){
				cellValue = cellValue.substring(0, 50) + "...";
			}
			return '<a href="javascript:;" onclick="lookInfo(\''+options.gid+'\',\''+options.rowId+'\')">'+cellValue+'</a>';
		};
	
	
	//弹框取消按钮
	$('#shouhuiyujing_cacle_btn').on('click',function(){
		layer.close(index);
	});
	$('.qx').on('click',function(){
		layer.close(index);
	});

	//表头编辑按钮
	$(document).on('click','#shouhuiyujing_update_btn',function(){
		flag = 'update';
		var rowIds = getSelectedRow();
		
		if(rowIds && $.isArray(rowIds) && rowIds.length == 1 ){
			
			var rowData = $("#shouhuiyujing_jqGrid").getRowData(rowIds[0]);
			
			//console.log(rowData);
			
			$('#shouhuiyujing_name').val(rowData.name),
		    $('#shouhuiyujing_relName').val(rowData.relName),
		    $('#shouhuiyujing_company').val(rowData.company),
		    $('#shouhuiyujing_createTime').val(rowData.createTime)
			title = '修改模块';
			index = layer.open({
				type: 1,
				title : title,
				area: ['60%', '70%'], //宽高
				content: $('#shouhuiyujing_formBox')
			});
		}else{
			layer.msg('同时只能选择一条记录!');
		}
	});
	
	//获取json数据
	function fetchGridData() {

		var gridArrayData = [];
		// show loading message
		$("#shouhuiyujing_jqGrid")[0].grid.beginReq();
		$.ajax({
			url: dataUrl,
			success: function(result) {
				for (var i = 0; i < result.items.length; i++) {
					var item = result.items[i];
					
					gridArrayData.push({
						hetongnumber: item.hetongnumber,
						hetongname: item.hetongname,
						time: item.time,
						startTime: item.startTime,
						endTime: item.endTime,
						dataTime: item.dataTime,
						overTime: item.overTime
					});

				}
				// set the new data
				$("#shouhuiyujing_jqGrid").jqGrid('setGridParam', {
					data: gridArrayData
				});
				// hide the show message
				$("#shouhuiyujing_jqGrid")[0].grid.endReq();
				// refresh the grid
				$("#shouhuiyujing_jqGrid").trigger('reloadGrid');
			}
		});
	}
	//格式化标题
	function formatTitle(cellValue, options, rowObject) {
		return cellValue.substring(0, 50) + "...";
	};
	//格式化链接
	function formatLink(cellValue, options, rowObject) {
		return "<a href='" + cellValue + "'>" + cellValue.substring(0, 25) + "..." + "</a>";
	};
	//获取选择的行
	function getSelectedRow() {
	    var grid = $("#shouhuiyujing_jqGrid");
	    var rowKeys = grid.jqGrid('getGridParam',"selarrrow");

	   return rowKeys;
	}
	
	
	changeSearch(); //修改工具条
	
});
function lookInfo(gid,rowId){
	$('#shenhecaigou_save_btn').show();
	var data = $('#'+gid).getRowData(rowId);
	data.name = $(data.name).text();
	data.relName = $(data.relName).text();
	setFormData(gid+'_formBox',data);
	title = '报关单查看信息';
	commIndex = layer.open({
		type: 1,
		title : title,
		area: ['98%', '98%'], //宽高
		content: $('#shouhuiyujing_formBox')
	});
}

	
</script>